import{r,j as e,H as Y,a as Z}from"./app-nFOrUbza.js";import{R as Q}from"./RepresentativeLayout-7ylgactW.js";import{d as ee,J as se,K as F,L as P,M as v,l as te,N as ae,O as re}from"./index-CQIIe2w9.js";/* empty css            */const we=({products:c,customers:le,representatives:ne})=>{const[l,i]=r.useState([]),[d,T]=r.useState(""),[N,I]=r.useState(c||[]),[u,h]=r.useState(""),[m,R]=r.useState(""),E=[...new Set((c||[]).map(s=>s.category).filter(Boolean))],[ie,oe]=r.useState("cash"),[ce,L]=r.useState(null),[de,B]=r.useState(null),[xe,M]=r.useState(""),[ue,$]=r.useState(""),[A,D]=r.useState(0),[b,w]=r.useState(0),[me,z]=r.useState(""),[ge,H]=r.useState(""),[he,be]=r.useState(!1),[fe,K]=r.useState({}),[C,f]=r.useState(!1),[O,g]=r.useState(!1),[x,W]=r.useState(null),J=r.useRef(null),G=r.useRef(null);r.useEffect(()=>{let s=c||[];m&&(s=s.filter(t=>t.category===m)),d&&(s=s.filter(t=>t.name.toLowerCase().includes(d.toLowerCase())||t.barcode.includes(d))),I(s)},[d,m,c]),r.useEffect(()=>{y()},[]);const S=async()=>{if(!u.trim())return;const s=c.find(t=>t.barcode===u);if(s){p(s),h("");return}try{const a=await(await fetch(`/representatives/pos/search-product?barcode=${u}`)).json();a.product?p(a.product):alert("لم يتم العثور على المنتج")}catch(t){console.error("خطأ في البحث:",t),alert("خطأ في البحث عن المنتج")}h("")},U=s=>{const t=s.image?`/storage/${s.image}`:"/images/no-product-image.png";W({src:t,name:s.name,barcode:s.barcode}),g(!0)},p=s=>{if(s.quantity<=0){alert("المنتج غير متوفر في المخزون");return}const t=l.find(a=>a.id===s.id);if(t){if(t.quantity+1>s.quantity){alert(`الكمية المتاحة: ${s.quantity}`);return}i(l.map(a=>a.id===s.id?{...a,quantity:a.quantity+1}:a))}else{const a={id:s.id,product:s,quantity:1,unit_sale_price:s.selling_price,unit_discount:0};i([...l,a])}},k=(s,t)=>{if(t<=0){_(s);return}i(l.map(a=>{if(a.id===s){const o=a.product;return t>o.quantity?(alert(`الكمية المتاحة: ${o.quantity}`),a):{...a,quantity:t}}return a}))},V=(s,t)=>{t<0||i(l.map(a=>a.id===s?{...a,unit_sale_price:t}:a))},X=(s,t)=>{t<0||i(l.map(a=>a.id===s?{...a,unit_discount:t}:a))},_=s=>{i(l.filter(t=>t.id!==s))},y=()=>{i([]),L(null),B(null),M(""),$(""),D(0),w(0),z(""),H(""),K({})},q=(()=>{const s=l.reduce((o,n)=>{const j=n.quantity*n.unit_sale_price-n.quantity*n.unit_discount;return o+j},0),t=s-b,a=t-A;return{subtotal:s,total:t,remaining:a,profit:l.reduce((o,n)=>{const j=(n.unit_sale_price-n.unit_discount-n.product.cost_price)*n.quantity;return o+j},0)}})();return e.jsxs(Q,{title:"نقطة البيع",children:[e.jsx(Y,{title:"نقطة البيع"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"البحث"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{ref:G,type:"text",value:d,onChange:s=>T(s.target.value),placeholder:"اسم المنتج أو الباركود...",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الفئة"}),e.jsxs("select",{value:m,onChange:s=>R(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"جميع الفئات"}),E.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الباركود"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{ref:J,type:"text",value:u,onChange:s=>h(s.target.value),onKeyPress:s=>s.key==="Enter"&&S(),placeholder:"مسح الباركود...",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"إضافة"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx("div",{className:"max-h-[70vh] overflow-y-auto",children:N.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-3 p-3",children:N.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("img",{src:s.image?`/storage/${s.image}`:"/images/no-product-image.png",alt:s.name,className:"w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>U(s),onError:t=>{t.target.src="/images/no-product-image.png"}}),e.jsxs("div",{className:"absolute top-1 right-1 bg-white px-1 py-0.5 rounded text-xs font-medium text-gray-600 shadow-sm",children:["#",s.barcode]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm leading-tight overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.name}),s.category&&e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:s.category}),e.jsx("div",{className:"text-xs text-gray-600",children:s.supplier_name||"غير محدد"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:[s.selling_price," د.ع"]}),e.jsxs("span",{className:"text-gray-500 text-xs",children:["/",s.unit]})]}),e.jsx("div",{className:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded-full",children:s.quantity})]}),e.jsxs("button",{onClick:()=>p(s),disabled:s.quantity<=0,className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(F,{className:"w-3 h-3"}),"إضافة"]})]})]},s.id))}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"لا توجد منتجات متاحة"})})})})]}),e.jsxs("button",{onClick:()=>f(!C),className:"fixed bottom-6 left-6 w-16 h-16 bg-green-600 text-white rounded-full shadow-lg hover:bg-green-700 transition-all duration-300 flex items-center justify-center z-40",children:[e.jsx(P,{className:"w-6 h-6"}),l.length>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:l.length})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center bg-green-600 text-white",children:[e.jsx("h3",{className:"text-lg font-bold",children:"السلة والدفع"}),e.jsx("button",{onClick:()=>f(!1),className:"text-white hover:text-gray-200 p-1",children:e.jsx(v,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex flex-col h-full max-h-[80vh]",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"منتجات السلة"}),l.length>0&&e.jsx("button",{onClick:y,className:"text-red-500 hover:text-red-700 p-1",title:"مسح السلة",children:e.jsx(te,{className:"w-4 h-4"})})]}),l.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(P,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"السلة فارغة"})]}):e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:l.map(s=>e.jsxs("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:s.product.name}),e.jsx("button",{onClick:()=>_(s.id),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(v,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{onClick:()=>k(s.id,s.quantity-1),className:"w-6 h-6 flex items-center justify-center bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:e.jsx(ae,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium min-w-8 text-center",children:s.quantity}),e.jsx("button",{onClick:()=>k(s.id,s.quantity+1),className:"w-6 h-6 flex items-center justify-center bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:e.jsx(F,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600",children:"سعر البيع"}),e.jsx("input",{type:"number",step:"0.01",value:s.unit_sale_price,onChange:t=>V(s.id,parseFloat(t.target.value)||0),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600",children:"خصم الوحدة"}),e.jsx("input",{type:"number",step:"0.01",value:s.unit_discount,onChange:t=>X(s.id,parseFloat(t.target.value)||0),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-green-500"})]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["المجموع: ",((s.unit_sale_price-s.unit_discount)*s.quantity).toFixed(2)," د.ع"]})})]},s.id))}),l.length>0&&e.jsxs("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"خصم إضافي"}),e.jsx("input",{type:"number",step:"0.01",value:b,onChange:s=>w(parseFloat(s.target.value)||0),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500",placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsxs("span",{className:"font-semibold",children:[q.subtotal.toFixed(2)," د.ع"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"الإجمالي:"}),e.jsxs("span",{className:"text-green-600",children:[q.total.toFixed(2)," د.ع"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{f(!1),Z.visit("/representatives/pos/invoice",{method:"post",data:{cart:l,discountAmount:b}})},disabled:l.length===0,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),"إتمام الدفع"]}),e.jsx("button",{onClick:y,className:"px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"مسح"})]})]})]})})]})}),O&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",onClick:()=>g(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:x.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["باركود: #",x.barcode]})]}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(v,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("img",{src:x.src,alt:x.name,className:"w-full h-auto max-h-[60vh] object-contain rounded-lg",onError:s=>{s.target.src="/images/no-product-image.png"}})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 text-center",children:e.jsx("button",{onClick:()=>g(!1),className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"إغلاق"})})]})})]})};export{we as default};
