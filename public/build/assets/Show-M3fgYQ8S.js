import{r as m,j as e,H as w,L as S,a as N}from"./app-DLu82VbL.js";import{P as v}from"./PreparerLayout-CIPI0HSY.js";import{m as F,R as A,n as z,h as L,S as T,T as k,C as u}from"./index-UdTL3sIO.js";/* empty css            */const C=m.forwardRef(({invoice:t},n)=>{if(!t)return null;const d=t.items?.reduce((r,l)=>r+parseFloat(l.unit_sale_price||l.price||0)*parseFloat(l.quantity||1),0)||0,c=parseFloat(t.discount_amount)||0,h=0,x=parseFloat(t.total_amount)||d,p=parseFloat(t.paid_amount)||0,o=parseFloat(t.remaining_amount)||x-p;return e.jsxs("div",{ref:n,className:"print-area",style:{fontFamily:"Tahoma, Arial, sans-serif",background:"#fff",color:"#222",width:"160mm",minHeight:"277mm",maxWidth:"160mm",margin:"10mm auto",direction:"rtl",boxSizing:"border-box",padding:0,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs("div",{style:{padding:0,margin:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"24px",marginBottom:"8px",padding:"0 32px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[e.jsx("img",{src:"/images/logo.png",alt:"شعار الشركة",style:{height:48,width:"auto",objectFit:"contain",marginLeft:12}}),e.jsx("div",{style:{textAlign:"right",fontWeight:"bold",fontSize:20,color:"#ff7a00",letterSpacing:1},children:"GO"})]}),e.jsxs("div",{style:{textAlign:"left",color:"#888",fontSize:12},children:[e.jsx("div",{children:new Date().toLocaleString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{style:{marginTop:8},children:"فاتورة مبيعات"})]})]}),e.jsx("hr",{style:{border:"none",borderTop:"1px solid #eee",margin:"0 32px 12px 32px"}})]}),e.jsx("div",{style:{padding:"0 32px",marginTop:"8px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:18,color:"#888"},children:"فاتورة مبيعات"}),e.jsxs("div",{style:{fontSize:15,color:"#888"},children:["رقم: ",e.jsx("b",{children:t.sale_number||t.id})]}),e.jsxs("div",{style:{fontSize:15,color:"#888"},children:["تاريخ: ",t.created_at?.split("T")[0]]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0 32px",marginBottom:"12px",marginTop:"8px",fontSize:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"#ff7a00",fontSize:18},children:t.customer_name||t.customer&&t.customer.name}),e.jsx("div",{style:{color:"#888",fontSize:15},children:t.customer_phone||t.customer&&t.customer.phone}),e.jsx("div",{style:{fontSize:15},children:"العميل"})]}),e.jsxs("div",{style:{textAlign:"left",fontSize:15},children:[e.jsxs("div",{children:["طريقة الدفع: ",t.payment_status==="paid"?"مدفوع":t.payment_status==="partial"?"مدفوع جزئي":"دين"]}),t.due_date&&e.jsxs("div",{children:["تاريخ الاستحقاق: ",t.due_date]})]})]}),e.jsx("div",{style:{padding:"0 32px",marginTop:"8px",flex:1},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:15,marginTop:0,minHeight:"120px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#ff7a00",color:"#fff"},children:[e.jsx("th",{style:{border:"1px solid #eee",padding:6},children:"#"}),e.jsx("th",{style:{border:"1px solid #eee",padding:6},children:"المنتج"}),e.jsx("th",{style:{border:"1px solid #eee",padding:6},children:"السعر"}),e.jsx("th",{style:{border:"1px solid #eee",padding:6},children:"الكمية"}),e.jsx("th",{style:{border:"1px solid #eee",padding:6},children:"الإجمالي"})]})}),e.jsx("tbody",{children:t.items&&t.items.length>0?t.items.map((r,l)=>e.jsxs("tr",{style:{background:l%2===0?"#fff":"#f7f7f7"},children:[e.jsx("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:l+1}),e.jsx("td",{style:{border:"1px solid #eee",padding:6},children:r.product&&(r.product.name_ar||r.product.name_en||r.product.name)||r.name}),e.jsxs("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:[parseFloat(r.unit_sale_price||r.price||0).toLocaleString()," د.ع"]}),e.jsx("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:r.quantity}),e.jsxs("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:[(parseFloat(r.unit_sale_price||r.price||0)*parseFloat(r.quantity||1)).toLocaleString()," د.ع"]})]},r.id)):Array.from({length:7}).map((r,l)=>e.jsxs("tr",{style:{background:l%2===0?"#fff":"#f7f7f7"},children:[e.jsx("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:l+1}),e.jsx("td",{style:{border:"1px solid #eee",padding:6},children:" "}),e.jsx("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:" "}),e.jsx("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:" "}),e.jsx("td",{style:{border:"1px solid #eee",padding:6,textAlign:"center"},children:" "})]},l))})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"0 32px",marginTop:"8px"},children:e.jsx("table",{style:{minWidth:260,fontSize:15},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{padding:4},children:"المجموع الفرعي:"}),e.jsxs("td",{style:{padding:4,textAlign:"left"},children:[d.toLocaleString()," د.ع"]})]}),c>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{padding:4},children:"الخصم:"}),e.jsxs("td",{style:{padding:4,textAlign:"left"},children:["-",c.toLocaleString()," د.ع"]})]}),h>0,e.jsxs("tr",{style:{fontWeight:"bold",color:"#ff7a00"},children:[e.jsx("td",{style:{padding:4},children:"الإجمالي:"}),e.jsxs("td",{style:{padding:4,textAlign:"left"},children:[x.toLocaleString()," د.ع"]})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{padding:4},children:"المدفوع:"}),e.jsxs("td",{style:{padding:4,textAlign:"left"},children:[p.toLocaleString()," د.ع"]})]}),o>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{padding:4},children:"المتبقي:"}),e.jsxs("td",{style:{padding:4,textAlign:"left",color:"#d32f2f"},children:[o.toLocaleString()," د.ع"]})]})]})})}),e.jsxs("div",{style:{padding:"0 32px",fontSize:14,color:"#666",marginTop:"12px"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#ff7a00",marginBottom:4},children:"الشروط والأحكام"}),e.jsx("div",{style:{marginBottom:8},children:"هذه الفاتورة صالحة لمدة 7 أيام من تاريخ الإصدار. يرجى مراجعة البضاعة عند الاستلام."}),e.jsx("div",{children:"شكراً لتعاملكم معنا!"})]}),e.jsxs("div",{style:{padding:"0 32px",fontSize:14,color:"#888",marginTop:"24px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0,whiteSpace:"normal",overflowWrap:"break-word",wordBreak:"break-word"},children:[e.jsx("span",{style:{marginBottom:2},children:"xxx-xxx-xxxx"}),e.jsx("span",{style:{marginBottom:2},children:"info@company.com"}),e.jsx("span",{children:"www.company.com"})]}),e.jsx("div",{style:{fontWeight:"bold",fontSize:15,marginTop:8,marginRight:16,flexShrink:0},children:"توقيع"})]})]})});function P({invoice:t}){let n;t&&t.items&&t.items.length>0?n={sale_number:t.sale_number,customer_name:t.customer_name||t.customer&&t.customer.name,customer_phone:t.customer_phone||t.customer&&t.customer.phone,total_amount:t.total_amount,created_at:t.created_at,items:t.items.map(s=>({id:s.id,name:s.product&&(s.product.name_ar||s.product.name_en||s.product.name)||s.name,quantity:s.quantity,unit:s.product?s.product.unit_ar||s.product.unit||"":s.unit||"",image:s.product?s.product.image_url||s.product.image:null})),seller_representative:t.sellerRepresentative||t.seller_representative,primary_supplier:t.primarySupplier||t.primary_supplier,items_count:t.items_count,status:t.status}:n={sale_number:"INV-2025-001",customer_name:"أحمد محمد علي",customer_phone:"07701234567",total_amount:25e4,created_at:"2025-08-29T10:30:00",items:[{id:1,name:"منتج 1",quantity:2,unit:"قطعة",price:1e4},{id:2,name:"منتج 2",quantity:1,unit:"كرتون",price:5e4},{id:3,name:"منتج 3",quantity:5,unit:"قطعة",price:2e3}],seller_representative:{name:"محمد الأحمد",phone:"07809876543"},primary_supplier:{name_ar:"مورد المواد الغذائية"},items_count:8,status:"preparing"};const d=n.items.reduce((s,a)=>{const i=t&&t.items&&t.items.find(_=>_.id===a.id)?.product,g=parseFloat(i?.piece_weight_grams)||0,j=parseFloat(i?.pieces_per_carton)||1,b=parseFloat(a.quantity)||0;return s+b*j*g},0),c=d/1e3,[h,x]=m.useState(()=>n.items.map(()=>!1)),[p,o]=m.useState(!1),r=m.useRef(),l=s=>{x(a=>a.map((i,g)=>g===s?!i:i))},f=()=>{o(!0),N.patch(`/preparer/invoices/${t.id}/complete`,{status:"ready_for_delivery",prepared_by:t.prepared_by,preparation_notes:"تم تجهيز الفاتورة بنجاح"},{onSuccess:()=>{o(!1),window.location.href="/preparer/invoices/preparing"},onError:()=>{o(!1),alert("حدث خطأ أثناء تحديث حالة الفاتورة")}})},y=()=>{const s=r.current.innerHTML,a=window.open("","","width=900,height=650");a.document.write("<html><head><title>طباعة الفاتورة</title>"),a.document.write("<style>body{direction:rtl;font-family:tahoma,Arial,sans-serif;} table{border-collapse:collapse;width:100%;} th,td{border:1px solid #ccc;padding:4px;text-align:center;} .text-center{text-align:center;}</style>"),a.document.write("</head><body>"),a.document.write(s),a.document.write("</body></html>"),a.document.close(),a.focus(),a.print(),a.close()};return e.jsxs(v,{title:`تفاصيل الفاتورة ${n.sale_number}`,children:[e.jsx(w,{title:`تفاصيل الفاتورة ${n.sale_number}`}),e.jsxs("div",{className:"max-w-md mx-auto p-2 sm:p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(S,{href:"/preparer/invoices/preparing",className:"text-blue-600 flex items-center text-sm",children:[e.jsx(F,{className:"ml-1"})," رجوع"]}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:n.status==="preparing"?"قيد التجهيز":""})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 space-y-2",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:y,className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm shadow",children:"طباعة الفاتورة"})}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse mb-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-bold text-lg",children:n.sale_number})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(z,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:n.customer_name}),e.jsx(L,{className:"w-4 h-4 text-gray-400 ml-2"}),e.jsx("span",{children:n.customer_phone})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[parseInt(n.total_amount).toLocaleString("en-US")," IQD"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(k,{className:"w-5 h-5 text-green-500 ml-2"}),e.jsxs("span",{className:"font-bold",children:["المنتجات (",n.items.length,")"]})]}),e.jsx("ul",{className:"divide-y divide-gray-100",children:n.items.map((s,a)=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:h[a],onChange:()=>l(a),className:"form-checkbox h-5 w-5 text-green-600 border-gray-300 rounded ml-2"}),e.jsx("img",{src:s.image?s.image.startsWith("http")?s.image:`/storage/${s.image}`:"/images/no-product-image.png",alt:s.name,className:"w-10 h-10 object-cover rounded ml-2 border",onError:i=>{i.target.src="/images/no-product-image.png"}}),e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"mx-2 text-xs text-gray-500",children:["(",s.unit,")"]})]}),e.jsx("div",{className:"text-sm text-gray-700 font-bold",children:s.quantity})]},s.id))}),e.jsx("div",{style:{display:"none"},ref:r,children:e.jsx(C,{invoice:t})}),e.jsxs("div",{className:"mt-4 p-3 bg-purple-50 rounded-lg border border-purple-200 text-center",children:[e.jsx("div",{className:"font-semibold text-purple-900 mb-1",children:"الوزن الكلي للفاتورة"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[d>0?d.toLocaleString():"0"," غرام"]}),c>=1&&e.jsxs("div",{className:"text-lg text-purple-600 mt-1",children:["(",c.toFixed(2)," كيلو غرام)"]}),d===0&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"(لا توجد بيانات وزن للمنتجات)"})]}),e.jsxs("button",{onClick:f,disabled:p,className:"w-full mt-4 flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[p?e.jsx("span",{className:"animate-spin mr-2",children:e.jsx(u,{})}):e.jsx(u,{className:"ml-2"}),"إكمال التجهيز الآن"]})]})]})]})}export{P as default};
